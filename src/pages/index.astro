---
import ListCategories from '@/components/ListCategories'
import ListPosts from '@/components/ListPosts'
import TitlePage from '@/components/TitlePage'
import BaseLayout from '@/layouts/BaseLayout'
import { getPosts, filterPostsByDateRange } from '@/utils'
import FilterForm from '../components/FilterForm.tsx'

const MAX_POSTS = 5 // max number of posts to show on the home page

// hard coded the date
const startDate = undefined
const endDate = undefined

let posts = await getPosts()

const handleFilter = async (startDate: Date, endDate: Date) => {
	posts = await getPosts(startDate, endDate, MAX_POSTS)
} // Get the 5 most recent posts within the range

// const handleFilter = async (event: Event) => {
//   event.preventDefault();
//   const formData = new FormData(event.target as HTMLFormElement);

//   const startDateStr = formData.get('startDate') as string;
//   const endDateStr = formData.get('endDate') as string;

//   const startDate = startDateStr ? new Date(startDateStr) : undefined;
//   const endDate = endDateStr ? new Date(endDateStr) : undefined;

//   try {
//     posts = await getPosts(startDate, endDate);
//   } catch (error) {
//     console.error('Error fetching posts:', error);
//   }
// };

// const posts = await getPosts(MAX_POSTS)

// const handleFilter = async (event: Event) => {
// 	event.preventDefault()
// 	const formData = new FormData(event.target as HTMLFormElement)

// 	const startDateString = formData.get('startDate') as string
// 	const endDateString = formData.get('endDate') as string

// 	const startDate = new Date(startDateString)
// 	const endDate = new Date(endDateString)

// 	// Fetch filtered posts based on the date range
// 	const filteredPosts = await filterPostsByDateRange(startDate, endDate)
// 	return filteredPosts
// }
---

<BaseLayout title='Home'>
	<TitlePage title='Blog Title' />
	<ListCategories />

	<div>
		<div class='w-full flex justify-between items-center'>
			<!-- <div class='flex text-lg font-medium items-center gap-4'>
				 <h2>Filter by Date:</h2>

				<label for='startDate'>Start Date:</label>
				<input id='startDate' class='text-black' type='date' name='startDate' required />

				<label for='endDate'>End Date:</label>
				<input id='endDate' class='text-black' type='date' name='endDate' required />

				<button id='filterBtn'>Filter</button> 

				 <button
					class='px-2 py-1 border border-solid dark:border-gray-600 rounded-lg font-normal text-base'
					>Reading time</button
				> 
				 <button
					class='px-2 py-1 border border-solid dark:border-gray-600 rounded-lg font-normal text-base'
					>Date</button
				> 
			</div> -->
			<h2 class='text-lg font-medium tracking-wide text-end'>Latest Posts</h2>
			<div class='flex text-lg font-medium items-center gap-4'>
				<FilterForm onFilter={handleFilter} />
			</div>
		</div>

		<ListPosts FirstBig={true} posts={posts} />
	</div>
</BaseLayout>

<script>
	import { animate } from 'motion'

	const showAnimations = localStorage.getItem('animations') === 'true'

	if (showAnimations) {
		animate(
			'.title',
			{ y: [80, 0], opacity: [0, 1] },
			{
				duration: 2.5,
				opacity: { duration: 3 },

				offset: [0, 0.55, 0.75]
			}
		)
	}

	// const startDateInput = document.getElementById('startDate') as HTMLInputElement
	// const endDateInput = document.getElementById('endDate') as HTMLInputElement

	// function handleClick() {
	// 	const startDate = new Date(startDateInput.value)
	// 	const endDate = new Date(endDateInput.value)
	// 	// const filteredPosts = await filterPostsByDateRange(startDate, endDate)
	// 	console.log(endDate)
	// }
	// const filterButton = document.getElementById('button') as HTMLButtonElement
	// filterButton.addEventListener('click', handleClick)

	// function handleClick() {
	// 	console.log('clicked')
	// }
	// const filterButton = document.getElementById('button') as HTMLButtonElement
	// filterButton.addEventListener('click', handleClick)
	//  const filterButton = document.getElementById('filterBtn') as HTMLButtonElement

	// const filter = async () => {
	// 	const startDate = new Date(startDateInput.value)
	// 	const endDate = new Date(endDateInput.value)
	// 	const filteredPosts = await filterPostsByDateRange(startDate, endDate)
	// }
</script>
